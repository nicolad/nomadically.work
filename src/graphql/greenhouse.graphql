# Greenhouse ATS-related GraphQL queries
#import "./company-fragments.graphql"

# Query to fetch all Greenhouse jobs
query GetGreenhouseJobs($search: String, $limit: Int, $offset: Int) {
  jobs(
    sourceType: "greenhouse"
    search: $search
    limit: $limit
    offset: $offset
  ) {
    jobs {
      id
      external_id
      source_id
      source_kind
      company_id
      company_key
      company {
        ...CompanyFields
      }
      title
      location
      url
      description
      posted_at
      score
      score_reason
      is_remote_eu
      remote_eu_confidence
      remote_eu_reason
      skills {
        tag
        level
        confidence
        evidence
      }
      created_at
      updated_at
    }
    totalCount
  }
}

# Query to fetch a single Greenhouse job by ID
# Useful for checking if a job already exists during ingestion
query GetGreenhouseJobById($id: String!) {
  job(id: $id) {
    id
    external_id
    source_id
    source_kind
    company_id
    company_key
    company {
      ...CompanyFields
    }
    title
    location
    url
    description
    posted_at
    score
    score_reason
    is_remote_eu
    remote_eu_confidence
    remote_eu_reason
    skills {
      tag
      level
      confidence
      evidence
    }
    created_at
    updated_at
  }
}

# Mutation to enhance a job with data from Greenhouse, Lever, or Ashby API
mutation EnhanceJobFromATS(
  $jobId: String!
  $company: String!
  $source: String!
) {
  enhanceJobFromATS(jobId: $jobId, company: $company, source: $source) {
    success
    message
    job {
      id
      external_id
      source_id
      source_kind
      company_id
      company_key
      company {
        ...CompanyFields
      }
      title
      location
      url
      description
      posted_at
      score
      score_reason
      is_remote_eu
      remote_eu_confidence
      remote_eu_reason
      skills {
        tag
        level
        confidence
        evidence
      }

      # Greenhouse ATS fields
      absolute_url
      internal_job_id
      requisition_id
      company_name
      first_published
      language
      metadata {
        id
        name
        value
        value_type
      }
      departments {
        id
        name
        child_ids
        parent_id
      }
      offices {
        id
        name
        location
        child_ids
        parent_id
      }
      questions {
        description
        label
        required
        fields {
          type
          name
        }
      }
      location_questions {
        description
        label
        required
        fields {
          type
          name
        }
      }
      compliance {
        type
        description
        questions {
          description
          label
          required
          fields {
            type
            name
          }
        }
      }
      demographic_questions {
        header
        description
        questions {
          description
          label
          required
          fields {
            type
            name
          }
        }
      }
      data_compliance {
        type
        requires_consent
        requires_processing_consent
        requires_retention_consent
        retention_period
        demographic_data_consent_applies
      }

      # Lever ATS fields
      categories {
        commitment
        location
        team
        department
        allLocations
      }
      workplace_type
      country
      opening
      opening_plain
      description_body
      description_body_plain
      additional
      additional_plain
      lists {
        text
        content
      }
      ats_created_at

      created_at
      updated_at
    }
    enhancedData
  }
}
