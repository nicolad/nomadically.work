name = "nomadically-work-insert-jobs"
main = "workers/insert-jobs.ts"
compatibility_date = "2026-02-01"

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "nomadically-work-db"
database_id = "632b9c57-8262-40bd-86c2-bc08beab713b"

# Secrets (set via: npx wrangler secret put SECRET_NAME --name nomadically-work-insert-jobs)
# - API_SECRET (optional, for authentication)
# - NEXT_WEBHOOK_URL (required, e.g., https://nomadically.work/api/jobs/process)
# - WEBHOOK_SECRET (required, shared secret for Worker -> Next webhook)

# Queue configuration for async job processing pipeline
[[queues.producers]]
queue = "jobs-pipeline"
binding = "JOBS_QUEUE"

[[queues.consumers]]
queue = "jobs-pipeline"
max_batch_size = 1
max_batch_timeout = 1
max_retries = 10

# Observability - Enable logging
[observability]
enabled = true

[observability.logs]
enabled = true
invocation_logs = true
