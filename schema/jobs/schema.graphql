extend type Query {
  jobs(
    sourceType: String
    status: String
    search: String
    limit: Int
    offset: Int
    excludedCompanies: [String!]
  ): JobsResponse!
  job(id: String!): Job
  userSettings(userId: String!): UserSettings
  textToSql(question: String!): TextToSqlResult!
  executeSql(sql: String!): TextToSqlResult!
}

extend type Mutation {
  updateUserSettings(
    userId: String!
    settings: UserSettingsInput!
  ): UserSettings!
  deleteJob(id: Int!): DeleteJobResponse!
  enhanceJobFromATS(
    jobId: String!
    company: String!
    source: String!
  ): EnhanceJobResponse!
}

type JobSkill {
  tag: String!
  level: String!
  confidence: Float
  evidence: String
}

type GreenhouseDepartment {
  id: Int!
  name: String!
  child_ids: [Int!]!
  parent_id: Int
}

type GreenhouseOffice {
  id: Int!
  name: String!
  location: String
  child_ids: [Int!]!
  parent_id: Int
}

type GreenhouseQuestionField {
  type: String!
  name: String
}

type GreenhouseQuestion {
  description: String
  label: String!
  required: Boolean!
  fields: [GreenhouseQuestionField!]!
}

type GreenhouseMetadata {
  id: Int!
  name: String!
  value: String!
  value_type: String!
}

type GreenhouseDataCompliance {
  type: String!
  requires_consent: Boolean!
  requires_processing_consent: Boolean!
  requires_retention_consent: Boolean!
  retention_period: Int
  demographic_data_consent_applies: Boolean!
}

type GreenhouseCompliance {
  type: String!
  description: String
  questions: [GreenhouseQuestion!]
}

type GreenhouseDemographicQuestions {
  header: String
  description: String
  questions: [GreenhouseQuestion!]
}

type Job {
  id: Int!
  external_id: String!
  source_id: String
  source_kind: String!
  company_id: Int
  company_key: String!
  company: Company
  title: String!
  location: String
  url: String!
  description: String
  posted_at: String!
  score: Float
  score_reason: String
  status: String
  is_remote_eu: Boolean
  remote_eu_confidence: String
  remote_eu_reason: String
  skills: [JobSkill!]

  # Greenhouse ATS fields (parsed from ats_data)
  absolute_url: String
  internal_job_id: Int
  requisition_id: String
  company_name: String
  first_published: String
  language: String
  metadata: [GreenhouseMetadata!]
  departments: [GreenhouseDepartment!]
  offices: [GreenhouseOffice!]
  questions: [GreenhouseQuestion!]
  location_questions: [GreenhouseQuestion!]
  compliance: [GreenhouseCompliance!]
  demographic_questions: GreenhouseDemographicQuestions
  data_compliance: [GreenhouseDataCompliance!]

  created_at: String!
  updated_at: String!
}

type JobsResponse {
  jobs: [Job!]!
  totalCount: Int!
}

type UserSettings {
  id: Int!
  user_id: String!
  email_notifications: Boolean!
  daily_digest: Boolean!
  new_job_alerts: Boolean!
  preferred_locations: [String!]
  preferred_skills: [String!]
  excluded_companies: [String!]
  dark_mode: Boolean!
  jobs_per_page: Int!
  created_at: String!
  updated_at: String!
}

input UserSettingsInput {
  email_notifications: Boolean
  daily_digest: Boolean
  new_job_alerts: Boolean
  preferred_locations: [String!]
  preferred_skills: [String!]
  excluded_companies: [String!]
  dark_mode: Boolean
  jobs_per_page: Int
}

type TextToSqlResult {
  sql: String!
  explanation: String
  columns: [String!]!
  rows: [[JSON]]!
  drilldownSearchQuery: String
}

type DeleteJobResponse {
  success: Boolean!
  message: String
}

type EnhanceJobResponse {
  success: Boolean!
  message: String
  job: Job
  enhancedData: JSON
}
