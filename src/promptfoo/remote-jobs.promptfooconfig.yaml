# src/promptfoo/remote-jobs.promptfooconfig.yaml
description: "Remote AI jobs pipeline evals (2 buckets, strict remote/region/freshness, dedupe) via Promptfoo + Cloudflare"

# To enable LLM-graded rubric scoring, add this to a test case:
#   assert:
#     - type: llm-rubric
#       provider: "cloudflare-ai:chat:@cf/openai/gpt-oss-120b"
#       threshold: 0.9
#       value: |
#         You are auditing a JSON output containing two arrays: worldwide and europe.
#         Every item must be a fully-remote AI/LLM/GenAI engineering job posted within the last 24 hours.
#         Requirements:
#         - worldwide bucket: must explicitly indicate worldwide/global/work-from-anywhere remote.
#         - europe bucket: must explicitly indicate Europe/EU/EEA/UK/EMEA or CET/CEST/EET/EEST/UTC+0..3.
#         - must not be hybrid/onsite/in-office.
#         - must not be region-locked (e.g., US-only, Canada-only, or "authorized to work in the US" constraints).
#         - must include freshness proof (postedHoursAgo <= 24 OR postedAtIso within 24h).
#         Score 1.0 only if ALL items satisfy ALL requirements based on evidence fields; otherwise score lower.

prompts:
  # The provider ignores this prompt body and reads vars from the test case.
  - "RUN_MASTRA_PIPELINE"

providers:
  # Custom JS/TS provider file.
  # promptfoo supports loading providers from local files using file://
  - id: file://./providers/mastra-remote-jobs-provider.ts
    label: mastra-remote-jobs

# Default assertions for all tests
defaultTest:
  assert:
    # 1) Must parse as JSON and satisfy schema
    - type: is-json
      schema: file://./schemas/remoteJobsOutput.schema.json

    # 2) Exactly two buckets: worldwide + europe
    - type: javascript
      value: file://./assertions/twoBucketsOnly.js

    # 3) Strict invariants: remote/region/freshness/dedupe
    - type: javascript
      value: file://./assertions/strictInvariants.js

    # 4) Fixture regression: ensure known bad URLs are excluded (fixture-only tests)
    - type: javascript
      value: file://./assertions/excludesBadUrls.js

tests:
  # ----------------------------
  # Live test (requires BRAVE_SEARCH_API_KEY + DEEPSEEK_API_KEY env vars)
  # ----------------------------
  - description: "Live: last-24h worldwide+europe, strict filters, dedupe"
    vars:
      mode: "live"
      queryHint: "agentic"
      maxCandidatesPerMode: 25
      verifyTopNWithContext: 8
      minConfidence: 0.6
