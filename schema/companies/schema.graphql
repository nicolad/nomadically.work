extend type Query {
  companies(
    filter: CompanyFilterInput
    order_by: CompanyOrderBy
    limit: Int
    offset: Int
  ): CompaniesResponse!
  company(id: Int, key: String): Company
  company_facts(
    company_id: Int!
    field: String
    limit: Int
    offset: Int
  ): [CompanyFact!]!
  company_snapshots(
    company_id: Int!
    limit: Int
    offset: Int
  ): [CompanySnapshot!]!
  company_ats_boards(company_id: Int!): [ATSBoard!]!
}

extend type Mutation {
  createCompany(input: CreateCompanyInput!): Company!
  updateCompany(id: Int!, input: UpdateCompanyInput!): Company!
  deleteCompany(id: Int!): DeleteCompanyResponse!
  enhanceCompany(id: Int, key: String): EnhanceCompanyResponse!
  add_company_facts(
    company_id: Int!
    facts: [CompanyFactInput!]!
  ): [CompanyFact!]!
  upsert_company_ats_boards(
    company_id: Int!
    boards: [ATSBoardUpsertInput!]!
  ): [ATSBoard!]!
  ingest_company_snapshot(
    company_id: Int!
    source_url: String!
    crawl_id: String
    capture_timestamp: String
    fetched_at: String!
    http_status: Int
    mime: String
    content_hash: String
    text_sample: String
    jsonld: JSON
    extracted: JSON
    evidence: EvidenceInput!
  ): CompanySnapshot!
}

enum CompanyCategory {
  CONSULTANCY
  AGENCY
  STAFFING
  DIRECTORY
  PRODUCT
  OTHER
  UNKNOWN
}

enum ATSVendor {
  GREENHOUSE
  LEVER
  WORKABLE
  TEAMTAILOR
  ASHBY
  SMARTRECRUITERS
  JAZZHR
  BREEZYHR
  ICIMS
  JOBVITE
  SAP_SUCCESSFACTORS
  ORACLE_TALEO
  OTHER
}

enum ATSBoardType {
  JOBS_PAGE
  BOARD_API
  BOARD_WIDGET
  UNKNOWN
}

enum CompanyOrderBy {
  SCORE_DESC
  UPDATED_AT_DESC
  CREATED_AT_DESC
}

# Evidence / Provenance
type WarcPointer {
  filename: String!
  offset: Int!
  length: Int!
  digest: String
}

type Evidence {
  source_type: SourceType!
  source_url: String!
  crawl_id: String
  capture_timestamp: String
  observed_at: String!
  method: ExtractMethod!
  extractor_version: String
  http_status: Int
  mime: String
  content_hash: String
  warc: WarcPointer
}

# Company Facts (MDM)
type CompanyFact {
  id: Int!
  company_id: Int!
  field: String!
  value_json: JSON
  value_text: String
  normalized_value: JSON
  confidence: Float!
  evidence: Evidence!
  created_at: String!
}

# Company Snapshots
type CompanySnapshot {
  id: Int!
  company_id: Int!
  source_url: String!
  crawl_id: String
  capture_timestamp: String
  fetched_at: String!
  http_status: Int
  mime: String
  content_hash: String
  text_sample: String
  jsonld: JSON
  extracted: JSON
  evidence: Evidence!
  created_at: String!
}

# ATS Boards
type ATSBoard {
  id: Int!
  company_id: Int!
  url: String!
  vendor: ATSVendor!
  board_type: ATSBoardType!
  confidence: Float!
  is_active: Boolean!
  first_seen_at: String!
  last_seen_at: String!
  evidence: Evidence!
  created_at: String!
  updated_at: String!
}

# Company (Golden Record)
type Company {
  id: Int!
  key: String!
  name: String!
  logo_url: String
  website: String
  description: String
  industry: String
  size: String
  location: String
  created_at: String!
  updated_at: String!

  # Golden record fields
  canonical_domain: String
  category: CompanyCategory!
  tags: [String!]!
  services: [String!]!
  service_taxonomy: [String!]!
  industries: [String!]!
  score: Float!
  score_reasons: [String!]!
  last_seen_crawl_id: String
  last_seen_capture_timestamp: String
  last_seen_source_url: String

  # Related data
  ats_boards: [ATSBoard!]!
  facts(limit: Int, offset: Int, field: String): [CompanyFact!]!
  facts_count: Int!
  snapshots(limit: Int, offset: Int): [CompanySnapshot!]!
  snapshots_count: Int!
}

type CompaniesResponse {
  companies: [Company!]!
  totalCount: Int!
}

input CreateCompanyInput {
  key: String!
  name: String!
  logo_url: String
  website: String
  description: String
  industry: String
  size: String
  location: String
  canonical_domain: String
  category: CompanyCategory
  tags: [String!]
  services: [String!]
  service_taxonomy: [String!]
  industries: [String!]
}

input UpdateCompanyInput {
  key: String
  name: String
  logo_url: String
  website: String
  description: String
  industry: String
  size: String
  location: String
  canonical_domain: String
  category: CompanyCategory
  tags: [String!]
  services: [String!]
  service_taxonomy: [String!]
  industries: [String!]
  score: Float
  score_reasons: [String!]
}

input WarcPointerInput {
  filename: String!
  offset: Int!
  length: Int!
  digest: String
}

input EvidenceInput {
  source_type: SourceType!
  source_url: String!
  crawl_id: String
  capture_timestamp: String
  observed_at: String!
  method: ExtractMethod!
  extractor_version: String
  http_status: Int
  mime: String
  content_hash: String
  warc: WarcPointerInput
}

input CompanyFactInput {
  field: String!
  value_json: JSON
  value_text: String
  normalized_value: JSON
  confidence: Float!
  evidence: EvidenceInput!
}

input ATSBoardUpsertInput {
  url: String!
  vendor: ATSVendor!
  board_type: ATSBoardType!
  confidence: Float!
  is_active: Boolean!
  last_seen_at: String!
  evidence: EvidenceInput!
}

input CompanyFilterInput {
  text: String
  category_in: [CompanyCategory!]
  min_score: Float
  has_ats_boards: Boolean
  service_taxonomy_any: [String!]
  canonical_domain_in: [String!]
}

type DeleteCompanyResponse {
  success: Boolean!
  message: String
}

type EnhanceCompanyResponse {
  success: Boolean!
  message: String
  companyId: Int
  companyKey: String
}
